<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inversiones Boheme - Sistema de Inventario</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Importar jsPDF correctamente -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .btn-primary {
            background-color: #6366f1;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #4f46e5;
        }
        .btn-secondary {
            background-color: #f43f5e;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #e11d48;
        }
        .btn-success {
            background-color: #10b981;
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            background-color: #059669;
        }
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .logo {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex flex-col">
        <!-- Navbar -->
        <nav class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center">
                            <h1 class="text-2xl font-bold logo">Inversiones Boheme</h1>
                        </div>
                        <div class="ml-2 text-sm text-gray-500">Variedades, Víveres y Papelería</div>
                    </div>
                    <div class="flex items-center">
                        <span id="current-date" class="text-gray-600 mr-4"></span>
                        <button id="btn-nueva-venta" class="btn-primary text-white px-4 py-2 rounded-md">
                            Nueva Venta
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="flex-grow container mx-auto px-4 py-8">
            <!-- Dashboard Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="card bg-white rounded-lg shadow-md p-6 border-l-4 border-indigo-500">
                    <h2 class="text-lg font-semibold text-gray-700">Total Productos</h2>
                    <p id="total-productos" class="text-3xl font-bold text-indigo-600">0</p>
                </div>
                <div class="card bg-white rounded-lg shadow-md p-6 border-l-4 border-pink-500">
                    <h2 class="text-lg font-semibold text-gray-700">Ventas del Día</h2>
                    <p id="ventas-dia" class="text-3xl font-bold text-pink-600">$0</p>
                </div>
                <div class="card bg-white rounded-lg shadow-md p-6 border-l-4 border-emerald-500">
                    <h2 class="text-lg font-semibold text-gray-700">Valor del Inventario</h2>
                    <p id="valor-inventario" class="text-3xl font-bold text-emerald-600">$0</p>
                </div>
            </div>

            <!-- Tabs -->
            <div class="bg-white rounded-lg shadow-md mb-8">
                <div class="border-b border-gray-200">
                    <nav class="flex -mb-px">
                        <button id="tab-inventario" class="tab-btn text-indigo-600 border-indigo-500 py-4 px-6 border-b-2 font-medium text-sm">
                            Inventario
                        </button>
                        <button id="tab-ventas" class="tab-btn text-gray-500 hover:text-gray-700 py-4 px-6 border-b-2 border-transparent font-medium text-sm">
                            Ventas
                        </button>
                    </nav>
                </div>

                <!-- Inventario Tab Content -->
                <div id="content-inventario" class="p-6">
                    <div class="flex justify-between mb-6">
                        <div class="w-1/3">
                            <input type="text" id="buscar-producto" placeholder="Buscar producto..." 
                                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <button id="btn-agregar-producto" class="btn-primary text-white px-4 py-2 rounded-md mr-2">
                                Agregar Producto
                            </button>
                            <button id="btn-reporte-inventario" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">
                                Reporte PDF
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                                    <th class="py-3 px-6 text-left">Código</th>
                                    <th class="py-3 px-6 text-left">Producto</th>
                                    <th class="py-3 px-6 text-left">Categoría</th>
                                    <th class="py-3 px-6 text-right">Stock</th>
                                    <th class="py-3 px-6 text-right">Precio Compra</th>
                                    <th class="py-3 px-6 text-right">Precio Venta</th>
                                    <th class="py-3 px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-inventario" class="text-gray-600 text-sm">
                                <!-- Datos de inventario se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Ventas Tab Content -->
                <div id="content-ventas" class="p-6 hidden">
                    <div class="flex justify-between mb-6">
                        <div class="w-1/3">
                            <input type="date" id="fecha-ventas" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <button id="btn-reporte-ventas" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md">
                                Reporte Ventas PDF
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                                    <th class="py-3 px-6 text-left">ID Venta</th>
                                    <th class="py-3 px-6 text-left">Fecha</th>
                                    <th class="py-3 px-6 text-left">Hora</th>
                                    <th class="py-3 px-6 text-right">Productos</th>
                                    <th class="py-3 px-6 text-right">Total</th>
                                    <th class="py-3 px-6 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-ventas" class="text-gray-600 text-sm">
                                <!-- Datos de ventas se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-white py-4 shadow-inner">
            <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
                &copy; 2023 Inversiones Boheme - Sistema de Inventario
            </div>
        </footer>
    </div>

    <!-- Modal Agregar/Editar Producto -->
    <div id="modal-producto" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4">
            <div class="border-b px-6 py-4">
                <h3 id="modal-producto-titulo" class="text-lg font-semibold text-gray-700">Agregar Producto</h3>
            </div>
            <div class="p-6">
                <form id="form-producto">
                    <input type="hidden" id="producto-id">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-codigo">
                            Código
                        </label>
                        <input type="text" id="producto-codigo" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-nombre">
                            Nombre del Producto
                        </label>
                        <input type="text" id="producto-nombre" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-categoria">
                            Categoría
                        </label>
                        <select id="producto-categoria" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                            <option value="">Seleccione una categoría</option>
                            <option value="Víveres">Víveres</option>
                            <option value="Papelería">Papelería</option>
                            <option value="Aseo">Aseo</option>
                            <option value="Bebidas">Bebidas</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-stock">
                            Stock
                        </label>
                        <input type="number" id="producto-stock" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-precio-compra">
                            Precio de Compra
                        </label>
                        <input type="number" id="producto-precio-compra" min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="producto-precio-venta">
                            Precio de Venta
                        </label>
                        <input type="number" id="producto-precio-venta" min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    <div class="flex justify-end pt-4">
                        <button type="button" class="btn-cerrar-modal bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md mr-2">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary text-white px-4 py-2 rounded-md">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Nueva Venta -->
    <div id="modal-venta" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-4xl mx-4">
            <div class="border-b px-6 py-4">
                <h3 class="text-lg font-semibold text-gray-700">Nueva Venta</h3>
            </div>
            <div class="p-6">
                <div class="flex flex-col md:flex-row md:space-x-4 mb-6">
                    <div class="w-full md:w-2/3 mb-4 md:mb-0">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="venta-buscar-producto">
                            Buscar Producto
                        </label>
                        <input type="text" id="venta-buscar-producto" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Código o nombre del producto">
                    </div>
                    <div class="w-full md:w-1/3">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="venta-cantidad">
                            Cantidad
                        </label>
                        <div class="flex">
                            <input type="number" id="venta-cantidad" min="1" value="1" class="w-full px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <button id="btn-agregar-item" class="btn-success text-white px-4 py-2 rounded-r-md">
                                Agregar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto mb-6">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Código</th>
                                <th class="py-3 px-6 text-left">Producto</th>
                                <th class="py-3 px-6 text-right">Cantidad</th>
                                <th class="py-3 px-6 text-right">Precio</th>
                                <th class="py-3 px-6 text-right">Subtotal</th>
                                <th class="py-3 px-6 text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-venta-items" class="text-gray-600 text-sm">
                            <!-- Items de venta se cargarán aquí -->
                        </tbody>
                    </table>
                </div>

                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="text-xl font-bold text-gray-700 mb-4 md:mb-0">
                        Total: <span id="venta-total" class="text-indigo-600">$0.00</span>
                    </div>
                    <div class="flex">
                        <button type="button" class="btn-cerrar-modal bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md mr-2">
                            Cancelar
                        </button>
                        <button id="btn-finalizar-venta" class="btn-primary text-white px-4 py-2 rounded-md">
                            Finalizar Venta
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalle Venta -->
    <div id="modal-detalle-venta" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl mx-4">
            <div class="border-b px-6 py-4">
                <h3 class="text-lg font-semibold text-gray-700">Detalle de Venta</h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <p class="text-sm text-gray-600">ID Venta:</p>
                        <p id="detalle-id" class="font-semibold"></p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Fecha:</p>
                        <p id="detalle-fecha" class="font-semibold"></p>
                    </div>
                </div>

                <div class="overflow-x-auto mb-6">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Producto</th>
                                <th class="py-3 px-6 text-right">Cantidad</th>
                                <th class="py-3 px-6 text-right">Precio</th>
                                <th class="py-3 px-6 text-right">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-detalle-items" class="text-gray-600 text-sm">
                            <!-- Detalles de venta se cargarán aquí -->
                        </tbody>
                    </table>
                </div>

                <div class="flex justify-between items-center">
                    <div class="text-xl font-bold text-gray-700">
                        Total: <span id="detalle-total" class="text-indigo-600"></span>
                    </div>
                    <button type="button" class="btn-cerrar-modal bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Inicialización de variables globales
        let productos = JSON.parse(localStorage.getItem('productos')) || [];
        let ventas = JSON.parse(localStorage.getItem('ventas')) || [];
        let ventaActual = { items: [], total: 0 };
        let productoSeleccionado = null;

        // Función para formatear moneda
        const formatMoneda = (valor) => {
            return '$' + parseFloat(valor).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        };

        // Función para formatear fecha
        const formatFecha = (fecha) => {
            const f = new Date(fecha);
            return f.toLocaleDateString('es-ES');
        };

        // Función para formatear hora
        const formatHora = (fecha) => {
            const f = new Date(fecha);
            return f.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
        };

        // Función para generar ID único
        const generarId = () => {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 5).toUpperCase();
        };

        // Función para actualizar el dashboard
        const actualizarDashboard = () => {
            document.getElementById('total-productos').textContent = productos.length;
            
            let valorInventario = productos.reduce((total, producto) => {
                return total + (producto.precioCompra * producto.stock);
            }, 0);
            document.getElementById('valor-inventario').textContent = formatMoneda(valorInventario);
            
            const hoy = new Date().toISOString().split('T')[0];
            const ventasHoy = ventas.filter(venta => venta.fecha.split('T')[0] === hoy);
            const totalVentasHoy = ventasHoy.reduce((total, venta) => total + venta.total, 0);
            document.getElementById('ventas-dia').textContent = formatMoneda(totalVentasHoy);
        };

        // Función para cargar la tabla de inventario
        const cargarInventario = () => {
            const tabla = document.getElementById('tabla-inventario');
            const busqueda = document.getElementById('buscar-producto').value.toLowerCase();
            
            let html = '';
            const productosFiltrados = busqueda ? 
                productos.filter(p => p.codigo.toLowerCase().includes(busqueda) || 
                                     p.nombre.toLowerCase().includes(busqueda) ||
                                     p.categoria.toLowerCase().includes(busqueda)) : 
                productos;
            
            if (productosFiltrados.length === 0) {
                html = `<tr><td colspan="7" class="py-4 px-6 text-center">No hay productos registrados</td></tr>`;
            } else {
                productosFiltrados.forEach(producto => {
                    const stockClass = producto.stock <= 5 ? 'text-red-600 font-bold' : '';
                    html += `
                        <tr class="border-b border-gray-200 hover:bg-gray-50">
                            <td class="py-3 px-6">${producto.codigo}</td>
                            <td class="py-3 px-6">${producto.nombre}</td>
                            <td class="py-3 px-6">${producto.categoria}</td>
                            <td class="py-3 px-6 text-right ${stockClass}">${producto.stock}</td>
                            <td class="py-3 px-6 text-right">${formatMoneda(producto.precioCompra)}</td>
                            <td class="py-3 px-6 text-right">${formatMoneda(producto.precioVenta)}</td>
                            <td class="py-3 px-6 text-center">
                                <button class="btn-editar text-blue-600 hover:text-blue-900 mr-2" data-id="${producto.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                                <button class="btn-eliminar text-red-600 hover:text-red-900" data-id="${producto.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            tabla.innerHTML = html;
            
            // Agregar eventos a los botones de editar y eliminar
            document.querySelectorAll('.btn-editar').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.getAttribute('data-id');
                    editarProducto(id);
                });
            });
            
            document.querySelectorAll('.btn-eliminar').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.getAttribute('data-id');
                    eliminarProducto(id);
                });
            });
        };

        // Función para cargar la tabla de ventas
        const cargarVentas = () => {
            const tabla = document.getElementById('tabla-ventas');
            const fechaSeleccionada = document.getElementById('fecha-ventas').value;
            
            let ventasFiltradas = ventas;
            if (fechaSeleccionada) {
                ventasFiltradas = ventas.filter(venta => venta.fecha.split('T')[0] === fechaSeleccionada);
            }
            
            let html = '';
            if (ventasFiltradas.length === 0) {
                html = `<tr><td colspan="6" class="py-4 px-6 text-center">No hay ventas registradas</td></tr>`;
            } else {
                ventasFiltradas.forEach(venta => {
                    html += `
                        <tr class="border-b border-gray-200 hover:bg-gray-50">
                            <td class="py-3 px-6">${venta.id}</td>
                            <td class="py-3 px-6">${formatFecha(venta.fecha)}</td>
                            <td class="py-3 px-6">${formatHora(venta.fecha)}</td>
                            <td class="py-3 px-6 text-right">${venta.items.reduce((total, item) => total + item.cantidad, 0)}</td>
                            <td class="py-3 px-6 text-right">${formatMoneda(venta.total)}</td>
                            <td class="py-3 px-6 text-center">
                                <button class="btn-ver-venta text-blue-600 hover:text-blue-900" data-id="${venta.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            tabla.innerHTML = html;
            
            // Agregar eventos a los botones de ver venta
            document.querySelectorAll('.btn-ver-venta').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.getAttribute('data-id');
                    verDetalleVenta(id);
                });
            });
        };

        // Función para mostrar el modal de agregar/editar producto
        const mostrarModalProducto = (editar = false) => {
            const modal = document.getElementById('modal-producto');
            const titulo = document.getElementById('modal-producto-titulo');
            
            titulo.textContent = editar ? 'Editar Producto' : 'Agregar Producto';
            modal.classList.remove('hidden');
            
            if (!editar) {
                document.getElementById('form-producto').reset();
                document.getElementById('producto-id').value = '';
            }
        };

        // Función para editar un producto
        const editarProducto = (id) => {
            const producto = productos.find(p => p.id === id);
            if (producto) {
                document.getElementById('producto-id').value = producto.id;
                document.getElementById('producto-codigo').value = producto.codigo;
                document.getElementById('producto-nombre').value = producto.nombre;
                document.getElementById('producto-categoria').value = producto.categoria;
                document.getElementById('producto-stock').value = producto.stock;
                document.getElementById('producto-precio-compra').value = producto.precioCompra;
                document.getElementById('producto-precio-venta').value = producto.precioVenta;
                
                mostrarModalProducto(true);
            }
        };

        // Función para eliminar un producto
        const eliminarProducto = (id) => {
            if (confirm('¿Está seguro de eliminar este producto?')) {
                productos = productos.filter(p => p.id !== id);
                localStorage.setItem('productos', JSON.stringify(productos));
                cargarInventario();
                actualizarDashboard();
            }
        };

        // Función para mostrar el modal de nueva venta
        const mostrarModalVenta = () => {
            const modal = document.getElementById('modal-venta');
            modal.classList.remove('hidden');
            
            // Reiniciar la venta actual
            ventaActual = { items: [], total: 0 };
            document.getElementById('venta-buscar-producto').value = '';
            document.getElementById('venta-cantidad').value = 1;
            document.getElementById('tabla-venta-items').innerHTML = '';
            document.getElementById('venta-total').textContent = formatMoneda(0);
        };

        // Función para agregar un item a la venta actual
        const agregarItemVenta = () => {
            const busqueda = document.getElementById('venta-buscar-producto').value.trim();
            const cantidad = parseInt(document.getElementById('venta-cantidad').value);
            
            if (!busqueda || cantidad <= 0) {
                alert('Debe ingresar un producto y una cantidad válida');
                return;
            }
            
            // Buscar el producto por código o nombre
            const producto = productos.find(p => 
                p.codigo.toLowerCase() === busqueda.toLowerCase() || 
                p.nombre.toLowerCase() === busqueda.toLowerCase()
            );
            
            if (!producto) {
                alert('Producto no encontrado');
                return;
            }
            
            if (producto.stock < cantidad) {
                alert(`Stock insuficiente. Solo hay ${producto.stock} unidades disponibles.`);
                return;
            }
            
            // Verificar si el producto ya está en la venta
            const itemExistente = ventaActual.items.find(item => item.productoId === producto.id);
            
            if (itemExistente) {
                if (producto.stock < (itemExistente.cantidad + cantidad)) {
                    alert(`Stock insuficiente. Solo hay ${producto.stock} unidades disponibles.`);
                    return;
                }
                
                itemExistente.cantidad += cantidad;
                itemExistente.subtotal = itemExistente.cantidad * itemExistente.precio;
            } else {
                ventaActual.items.push({
                    productoId: producto.id,
                    codigo: producto.codigo,
                    nombre: producto.nombre,
                    cantidad: cantidad,
                    precio: producto.precioVenta,
                    subtotal: cantidad * producto.precioVenta
                });
            }
            
            // Actualizar el total de la venta
            ventaActual.total = ventaActual.items.reduce((total, item) => total + item.subtotal, 0);
            
            // Actualizar la tabla de items
            actualizarTablaVenta();
            
            // Limpiar campos
            document.getElementById('venta-buscar-producto').value = '';
            document.getElementById('venta-cantidad').value = 1;
            document.getElementById('venta-buscar-producto').focus();
        };

        // Función para actualizar la tabla de items de la venta
        const actualizarTablaVenta = () => {
            const tabla = document.getElementById('tabla-venta-items');
            let html = '';
            
            if (ventaActual.items.length === 0) {
                html = `<tr><td colspan="6" class="py-4 px-6 text-center">No hay productos agregados</td></tr>`;
            } else {
                ventaActual.items.forEach((item, index) => {
                    html += `
                        <tr class="border-b border-gray-200 hover:bg-gray-50">
                            <td class="py-3 px-6">${item.codigo}</td>
                            <td class="py-3 px-6">${item.nombre}</td>
                            <td class="py-3 px-6 text-right">${item.cantidad}</td>
                            <td class="py-3 px-6 text-right">${formatMoneda(item.precio)}</td>
                            <td class="py-3 px-6 text-right">${formatMoneda(item.subtotal)}</td>
                            <td class="py-3 px-6 text-center">
                                <button class="btn-eliminar-item text-red-600 hover:text-red-900" data-index="${index}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    `;
                });
            }
            
            tabla.innerHTML = html;
            document.getElementById('venta-total').textContent = formatMoneda(ventaActual.total);
            
            // Agregar eventos a los botones de eliminar item
            document.querySelectorAll('.btn-eliminar-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.getAttribute('data-index'));
                    eliminarItemVenta(index);
                });
            });
        };

        // Función para eliminar un item de la venta
        const eliminarItemVenta = (index) => {
            ventaActual.items.splice(index, 1);
            ventaActual.total = ventaActual.items.reduce((total, item) => total + item.subtotal, 0);
            actualizarTablaVenta();
        };

        // Función para finalizar la venta
        const finalizarVenta = () => {
            if (ventaActual.items.length === 0) {
                alert('No hay productos en la venta');
                return;
            }
            
            // Crear la venta
            const nuevaVenta = {
                id: generarId(),
                fecha: new Date().toISOString(),
                items: ventaActual.items,
                total: ventaActual.total
            };
            
            // Actualizar el stock de los productos
            ventaActual.items.forEach(item => {
                const producto = productos.find(p => p.id === item.productoId);
                if (producto) {
                    producto.stock -= item.cantidad;
                }
            });
            
            // Guardar la venta y actualizar productos
            ventas.push(nuevaVenta);
            localStorage.setItem('ventas', JSON.stringify(ventas));
            localStorage.setItem('productos', JSON.stringify(productos));
            
            // Cerrar el modal y actualizar datos
            document.getElementById('modal-venta').classList.add('hidden');
            cargarInventario();
            cargarVentas();
            actualizarDashboard();
            
            alert('Venta realizada con éxito');
        };

        // Función para ver el detalle de una venta
        const verDetalleVenta = (id) => {
            const venta = ventas.find(v => v.id === id);
            if (venta) {
                document.getElementById('detalle-id').textContent = venta.id;
                document.getElementById('detalle-fecha').textContent = `${formatFecha(venta.fecha)} ${formatHora(venta.fecha)}`;
                
                const tabla = document.getElementById('tabla-detalle-items');
                let html = '';
                
                venta.items.forEach(item => {
                    html += `
                        <tr class="border-b border-gray-200">
                            <td class="py-3 px-6">${item.nombre}</td>
                            <td class="py-3 px-6 text-right">${item.cantidad}</td>
                            <td class="py-3 px-6 text-right">${formatMoneda(item.precio)}</td>
                            <td class="py-3 px-6 text-right">${formatMoneda(item.subtotal)}</td>
                        </tr>
                    `;
                });
                
                tabla.innerHTML = html;
                document.getElementById('detalle-total').textContent = formatMoneda(venta.total);
                
                document.getElementById('modal-detalle-venta').classList.remove('hidden');
            }
        };

        // Función para generar reporte de inventario en PDF
        const generarReporteInventario = () => {
            // Verificar que jsPDF esté disponible
            if (typeof window.jspdf === 'undefined') {
                alert('Error: La biblioteca jsPDF no está cargada correctamente.');
                return;
            }

            try {
                // Crear un nuevo documento PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Título
                doc.setFontSize(18);
                doc.text('Inversiones Boheme', 105, 20, { align: 'center' });
                doc.setFontSize(14);
                doc.text('Reporte de Inventario', 105, 30, { align: 'center' });
                doc.setFontSize(10);
                doc.text(`Fecha: ${new Date().toLocaleDateString('es-ES')}`, 105, 40, { align: 'center' });
                
                // Tabla
                const headers = [['Código', 'Producto', 'Categoría', 'Stock', 'Precio Compra', 'Precio Venta', 'Valor Total']];
                const data = productos.map(p => [
                    p.codigo,
                    p.nombre,
                    p.categoria,
                    p.stock,
                    formatMoneda(p.precioCompra),
                    formatMoneda(p.precioVenta),
                    formatMoneda(p.precioCompra * p.stock)
                ]);
                
                // Agregar totales
                const totalValor = productos.reduce((total, p) => total + (p.precioCompra * p.stock), 0);
                data.push(['', '', '', '', '', 'TOTAL:', formatMoneda(totalValor)]);
                
                // Generar la tabla
                doc.autoTable({
                    head: headers,
                    body: data,
                    startY: 50,
                    theme: 'grid',
                    styles: { fontSize: 8 },
                    headStyles: { fillColor: [99, 102, 241] }
                });
                
                // Guardar PDF
                doc.save('reporte-inventario.pdf');
            } catch (error) {
                console.error('Error al generar el PDF:', error);
                alert('Error al generar el PDF. Por favor, intente nuevamente.');
            }
        };

        // Función para generar reporte de ventas en PDF
        const generarReporteVentas = () => {
            // Verificar que jsPDF esté disponible
            if (typeof window.jspdf === 'undefined') {
                alert('Error: La biblioteca jsPDF no está cargada correctamente.');
                return;
            }

            try {
                // Crear un nuevo documento PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const fechaSeleccionada = document.getElementById('fecha-ventas').value;
                
                let ventasFiltradas = ventas;
                let subtitulo = 'Todas las Ventas';
                
                if (fechaSeleccionada) {
                    ventasFiltradas = ventas.filter(venta => venta.fecha.split('T')[0] === fechaSeleccionada);
                    subtitulo = `Ventas del ${new Date(fechaSeleccionada).toLocaleDateString('es-ES')}`;
                }
                
                // Título
                doc.setFontSize(18);
                doc.text('Inversiones Boheme', 105, 20, { align: 'center' });
                doc.setFontSize(14);
                doc.text('Reporte de Ventas', 105, 30, { align: 'center' });
                doc.setFontSize(12);
                doc.text(subtitulo, 105, 40, { align: 'center' });
                doc.setFontSize(10);
                doc.text(`Generado: ${new Date().toLocaleDateString('es-ES')}`, 105, 50, { align: 'center' });
                
                // Tabla
                const headers = [['ID Venta', 'Fecha', 'Hora', 'Productos', 'Total']];
                const data = ventasFiltradas.map(v => [
                    v.id,
                    formatFecha(v.fecha),
                    formatHora(v.fecha),
                    v.items.reduce((total, item) => total + item.cantidad, 0),
                    formatMoneda(v.total)
                ]);
                
                // Agregar totales
                const totalVentas = ventasFiltradas.reduce((total, v) => total + v.total, 0);
                data.push(['', '', '', 'TOTAL:', formatMoneda(totalVentas)]);
                
                // Generar la tabla
                doc.autoTable({
                    head: headers,
                    body: data,
                    startY: 60,
                    theme: 'grid',
                    styles: { fontSize: 8 },
                    headStyles: { fillColor: [99, 102, 241] }
                });
                
                // Guardar PDF
                doc.save('reporte-ventas.pdf');
            } catch (error) {
                console.error('Error al generar el PDF:', error);
                alert('Error al generar el PDF. Por favor, intente nuevamente.');
            }
        };

        // Inicialización de la aplicación
        document.addEventListener('DOMContentLoaded', () => {
            // Mostrar fecha actual
            const fechaActual = new Date();
            document.getElementById('current-date').textContent = fechaActual.toLocaleDateString('es-ES', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Inicializar fecha en el filtro de ventas
            document.getElementById('fecha-ventas').valueAsDate = fechaActual;
            
            // Cargar datos iniciales
            cargarInventario();
            cargarVentas();
            actualizarDashboard();
            
            // Eventos de los tabs
            document.getElementById('tab-inventario').addEventListener('click', () => {
                document.getElementById('tab-inventario').classList.add('text-indigo-600', 'border-indigo-500');
                document.getElementById('tab-inventario').classList.remove('text-gray-500', 'border-transparent');
                document.getElementById('tab-ventas').classList.add('text-gray-500', 'border-transparent');
                document.getElementById('tab-ventas').classList.remove('text-indigo-600', 'border-indigo-500');
                
                document.getElementById('content-inventario').classList.remove('hidden');
                document.getElementById('content-ventas').classList.add('hidden');
            });
            
            document.getElementById('tab-ventas').addEventListener('click', () => {
                document.getElementById('tab-ventas').classList.add('text-indigo-600', 'border-indigo-500');
                document.getElementById('tab-ventas').classList.remove('text-gray-500', 'border-transparent');
                document.getElementById('tab-inventario').classList.add('text-gray-500', 'border-transparent');
                document.getElementById('tab-inventario').classList.remove('text-indigo-600', 'border-indigo-500');
                
                document.getElementById('content-ventas').classList.remove('hidden');
                document.getElementById('content-inventario').classList.add('hidden');
            });
            
            // Evento de búsqueda de productos
            document.getElementById('buscar-producto').addEventListener('input', cargarInventario);
            
            // Evento de filtro de ventas por fecha
            document.getElementById('fecha-ventas').addEventListener('change', cargarVentas);
            
            // Evento para agregar/editar producto
            document.getElementById('btn-agregar-producto').addEventListener('click', () => mostrarModalProducto());
            
            document.getElementById('form-producto').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const id = document.getElementById('producto-id').value || generarId();
                const producto = {
                    id: id,
                    codigo: document.getElementById('producto-codigo').value,
                    nombre: document.getElementById('producto-nombre').value,
                    categoria: document.getElementById('producto-categoria').value,
                    stock: parseInt(document.getElementById('producto-stock').value),
                    precioCompra: parseFloat(document.getElementById('producto-precio-compra').value),
                    precioVenta: parseFloat(document.getElementById('producto-precio-venta').value)
                };
                
                // Verificar si es edición o nuevo
                const index = productos.findIndex(p => p.id === id);
                if (index !== -1) {
                    productos[index] = producto;
                } else {
                    productos.push(producto);
                }
                
                localStorage.setItem('productos', JSON.stringify(productos));
                document.getElementById('modal-producto').classList.add('hidden');
                cargarInventario();
                actualizarDashboard();
            });
            
            // Evento para nueva venta
            document.getElementById('btn-nueva-venta').addEventListener('click', mostrarModalVenta);
            
            // Evento para agregar item a la venta
            document.getElementById('btn-agregar-item').addEventListener('click', agregarItemVenta);
            
            // Evento para finalizar venta
            document.getElementById('btn-finalizar-venta').addEventListener('click', finalizarVenta);
            
            // Eventos para generar reportes
            document.getElementById('btn-reporte-inventario').addEventListener('click', generarReporteInventario);
            document.getElementById('btn-reporte-ventas').addEventListener('click', generarReporteVentas);
            
            // Eventos para cerrar modales
            document.querySelectorAll('.btn-cerrar-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.classList.add('hidden');
                    });
                });
            });
            
            // Agregar algunos productos de ejemplo si no hay ninguno
            if (productos.length === 0) {
                const productosEjemplo = [
                    {
                        id: generarId(),
                        codigo: 'P001',
                        nombre: 'Cuaderno Rayado',
                        categoria: 'Papelería',
                        stock: 50,
                        precioCompra: 1.50,
                        precioVenta: 2.50
                    },
                    {
                        id: generarId(),
                        codigo: 'P002',
                        nombre: 'Lápiz HB',
                        categoria: 'Papelería',
                        stock: 100,
                        precioCompra: 0.30,
                        precioVenta: 0.75
                    },
                    {
                        id: generarId(),
                        codigo: 'V001',
                        nombre: 'Arroz 1Kg',
                        categoria: 'Víveres',
                        stock: 30,
                        precioCompra: 1.20,
                        precioVenta: 1.80
                    },
                    {
                        id: generarId(),
                        codigo: 'V002',
                        nombre: 'Aceite 1L',
                        categoria: 'Víveres',
                        stock: 25,
                        precioCompra: 2.50,
                        precioVenta: 3.50
                    },
                    {
                        id: generarId(),
                        codigo: 'A001',
                        nombre: 'Detergente 500g',
                        categoria: 'Aseo',
                        stock: 20,
                        precioCompra: 1.80,
                        precioVenta: 2.50
                    }
                ];
                
                productos = productosEjemplo;
                localStorage.setItem('productos', JSON.stringify(productos));
                cargarInventario();
                actualizarDashboard();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'966ff280045f8b1f',t:'MTc1MzgyNzAzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
